<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Agenda de Eventos</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    :root {
      --primary: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); 
      --secondary: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --accent: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      --glass: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
    }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
      background-size: 400% 400%;
      animation: bg 15s ease infinite;
      min-height: 100vh;
      color: #2d3748;
    }
    @keyframes bg {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
    }
    .header {
      text-align: center;
      margin-bottom: 40px;
    }
    .header h1 {
      font-size: clamp(2.5rem, 5vw, 4rem);
      font-weight: 800;
      background: linear-gradient(135deg, #fff, #f0f0f0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 15px;
      animation: glow 3s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from { filter: drop-shadow(0 0 20px rgba(255,255,255,0.5)); }
      to { filter: drop-shadow(0 0 40px rgba(255,255,255,0.8)); }
    }
    .header p {
      font-size: 1.2rem;
      color: rgba(255,255,255,0.9);
    }
    .loading {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--primary);
      color: white;
      padding: 15px 25px;
      border-radius: 50px;
      font-weight: 600;
      z-index: 1000;
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }
    .loading.show {
      opacity: 1;
      transform: translateY(0);
    }
    .main-content {
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 40px;
      margin-bottom: 40px;
    }
    .glass-card {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 30px;
      padding: 40px;
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow);
    }
    .calendar-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    .nav-btn {
      background: var(--primary);
      color: white;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      transition: all 0.3s ease;
    }
    .nav-btn:hover {
      transform: scale(1.1);
    }
    .month-year {
      font-size: 2rem;
      font-weight: 700;
      color: white;
      background: var(--accent);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      background: var(--glass);
      border-radius: 20px;
      overflow: hidden;
    }
    .weekday {
      background: var(--primary);
      color: white;
      padding: 15px;
      text-align: center;
      font-weight: 700;
      font-size: 14px;
    }
    .day {
      background: rgba(255, 255, 255, 0.9);
      padding: 15px 10px;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    .day:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    .day.other-month {
      background: rgba(255, 255, 255, 0.3);
      color: #999;
    }
    .day.today {
      background: var(--accent);
      color: white;
      font-weight: 700;
    }
    .day.has-event {
      background: linear-gradient(135deg, #a8edea, #fed6e3);
    }
    .day.selected {
      background: var(--secondary);
      color: white;
      transform: scale(1.05);
    }
    .event-dots {
      display: flex;
      gap: 3px;
      margin-top: 5px;
    }
    .dot {
      width: 6px;
      height: 6px;
      background: #ff4757;
      border-radius: 50%;
    }
    .form-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 30px;
      color: white;
      text-align: center;
      background: var(--accent);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .form-group {
      margin-bottom: 25px;
    }
    .form-label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: rgba(255,255,255,0.9);
      font-size: 14px;
    }
    .form-input {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid var(--glass-border);
      border-radius: 15px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
      color: #2d3748;
    }
    .form-input:focus {
      outline: none;
      border-color: #4facfe;
      box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.2);
    }
    .form-textarea {
      resize: vertical;
      min-height: 100px;
      font-family: 'Inter', sans-serif;
    }
    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
      padding: 18px 40px;
      border-radius: 15px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }
    .btn-secondary {
      background: var(--secondary);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0 10px;
    }
    .btn-secondary:hover {
      transform: translateY(-2px);
    }
    .events-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 30px;
      color: white;
      text-align: center;
      background: var(--secondary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .event-item {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      border-left: 6px solid;
      border-image: var(--primary) 1;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .event-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }
    .event-today {
      border-image: var(--accent) 1;
      background: rgba(255, 245, 230, 0.95);
    }
    .event-past {
      border-image: linear-gradient(135deg, #a8a8a8, #d0d0d0) 1;
      opacity: 0.7;
    }
    .event-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .event-status {
      font-size: 12px;
      font-weight: 700;
      padding: 6px 12px;
      border-radius: 20px;
      text-transform: uppercase;
    }
    .status-today {
      background: var(--accent);
      color: white;
    }
    .status-future {
      background: var(--secondary);
      color: white;
    }
    .status-past {
      background: linear-gradient(135deg, #d0d0d0, #f0f0f0);
      color: #666;
    }
    .delete-btn {
      background: var(--accent);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.3s ease;
      align-self: flex-end;
      margin-top: 10px;
    }
    .delete-btn:hover {
      transform: scale(1.2);
    }
    .no-events {
      text-align: center;
      color: rgba(255,255,255,0.7);
      font-style: italic;
      padding: 60px;
      font-size: 18px;
    }
    .status-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 14px;
      z-index: 1000;
    }
    .status-online {
      background: var(--secondary);
      color: white;
    }
    .status-offline {
      background: #ff4757;
      color: white;
    }
    @media (max-width: 1200px) {
      .main-content {
        grid-template-columns: 1fr;
      }
    }
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      .day {
        min-height: 60px;
        padding: 10px 5px;
      }
      .glass-card {
        padding: 25px;
      }
      .event-item {
        padding: 20px;
      }
      .delete-btn {
        width: 32px;
        height: 32px;
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="loading" id="loading">üíæ Salvando...</div>
  <div class="status-indicator status-offline" id="statusIndicator">üî¥ Offline</div>
  <div class="container">
    <div class="header">
      <h1>‚ú® AGENDA SEA</h1>
      <p>Gest√£o de Eventos com Firebase</p>
    </div>
    <div class="main-content">
      <div class="glass-card">
        <div class="calendar-nav">
          <button class="nav-btn" onclick="prevMonth()">‚Äπ</button>
          <span class="month-year" id="monthYear"></span>
          <button class="nav-btn" onclick="nextMonth()">‚Ä∫</button>
        </div>
        <div class="calendar-grid" id="calendar"></div>
      </div>
      <div class="glass-card">
        <h2 class="form-title">üéØ Criar Evento</h2>
        <form id="eventForm">
          <div class="form-group">
            <label class="form-label">üìÖ Data</label>
            <input type="date" class="form-input" id="eventDate" required>
          </div>
          <div class="form-group">
            <label class="form-label">üé™ T√≠tulo</label>
            <input type="text" class="form-input" id="eventTitle" placeholder="Digite o t√≠tulo..." required>
          </div>
          <div class="form-group">
            <label class="form-label">‚è∞ Hor√°rio</label>
            <input type="text" class="form-input" id="eventTime" placeholder="Ex: 09h √†s 12h">
          </div>
          <div class="form-group">
            <label class="form-label">üìù Descri√ß√£o</label>
            <textarea class="form-input form-textarea" id="eventDescription" placeholder="Detalhes..."></textarea>
          </div>
          <button type="submit" class="btn-primary">üöÄ Criar Evento</button>
        </form>
      </div>
    </div>
    <div class="glass-card">
      <h2 class="events-title">üéâ Pr√≥ximos Eventos</h2>
      <div style="text-align: center; margin-bottom: 30px;">
        <button class="btn-secondary" onclick="exportEvents()">üíæ Exportar</button>
        <button class="btn-secondary" onclick="importEvents()">üìÇ Importar</button>
        <button class="btn-secondary" onclick="syncData()">üîÑ Sincronizar</button>
      </div>
      <div id="eventsList"></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js'; 
    import { getFirestore, addDoc, collection, getDocs, doc, deleteDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js'; 

    const firebaseConfig = {
      apiKey: "AIzaSyCFQCgGzitreC4TP7gXnEOcxD6UcY3j3jo",
      authDomain: "agenda-sea-c53f6.firebaseapp.com",
      projectId: "agenda-sea-c53f6",
      storageBucket: "agenda-sea-c53f6.firebasestorage.app",
      messagingSenderId: "205972566423",
      appId: "1:205972566423:web:4e7e90216137a3efe354d2",
      measurementId: "G-X824L5R790"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentDate = new Date();
    let events = [];
    const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
      'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
    const weekdays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];

    function createLocalDate(dateString) {
      const [year, month, day] = dateString.split('-').map(Number);
      return new Date(year, month - 1, day);
    }

    function formatDateString(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function getTodayDate() {
      const today = new Date();
      return new Date(today.getFullYear(), today.getMonth(), today.getDate());
    }

    function showLoading(message = 'üíæ Salvando...') {
      const loading = document.getElementById('loading');
      loading.textContent = message;
      loading.classList.add('show');
      setTimeout(() => loading.classList.remove('show'), 2000);
    }

    function updateStatus(online) {
      const indicator = document.getElementById('statusIndicator');
      if (online) {
        indicator.textContent = 'üü¢ Online';
        indicator.className = 'status-indicator status-online';
      } else {
        indicator.textContent = 'üî¥ Offline';
        indicator.className = 'status-indicator status-offline';
      }
    }

    async function loadEventsFromFirebase() {
      try {
        showLoading('üì• Carregando dados...');
        const querySnapshot = await getDocs(collection(db, "events"));
        events = [];
        querySnapshot.forEach((doc) => {
          events.push({
            id: doc.id,
            ...doc.data()
          });
        });
        updateStatus(true);
        renderCalendar();
        renderEvents();
      } catch (error) {
        console.error("Erro ao carregar eventos:", error);
        updateStatus(false);
        loadFromLocalStorage();
      }
    }

    async function saveEventToFirebase(eventData) {
      try {
        showLoading('üíæ Salvando evento...');
        const docRef = await addDoc(collection(db, "events"), eventData);
        eventData.id = docRef.id;
        events.push(eventData);
        updateStatus(true);
        return docRef.id;
      } catch (error) {
        console.error("Erro ao salvar evento:", error);
        updateStatus(false);
        events.push(eventData);
        saveToLocalStorage();
        throw error;
      }
    }

    async function deleteEventFromFirebase(eventId, index) {
      try {
        showLoading('üóëÔ∏è Excluindo evento...');
        if (eventId) {
          await deleteDoc(doc(db, "events", eventId));
        }
        events.splice(index, 1);
        updateStatus(true);
      } catch (error) {
        console.error("Erro ao excluir evento:", error);
        updateStatus(false);
        events.splice(index, 1);
        saveToLocalStorage();
        throw error;
      }
    }

    function loadFromLocalStorage() {
      const saved = localStorage.getItem('agendaEvents');
      if (saved) {
        events = JSON.parse(saved);
      } else {
        events = [
          {date: '2025-07-08', title: 'Visita √† COPPA', time: '09h', description: 'Projeto Adolecer +'},
          {date: '2025-07-09', title: 'Escola Maringuela', time: '08h √†s 12h', description: ''},
          {date: '2025-07-22', title: 'Educa√ß√£o ambiental para surdos', time: '', description: 'Manter contato com CB PM Teles - 71988941109'}
        ];
        saveToLocalStorage();
      }
      renderCalendar();
      renderEvents();
    }

    function saveToLocalStorage() {
      localStorage.setItem('agendaEvents', JSON.stringify(events));
    }

    function setupRealtimeListener() {
      try {
        const unsubscribe = onSnapshot(collection(db, "events"), (snapshot) => {
          events = [];
          snapshot.forEach((doc) => {
            events.push({
              id: doc.id,
              ...doc.data()
            });
          });
          renderCalendar();
          renderEvents();
          updateStatus(true);
        });
        return unsubscribe;
      } catch (error) {
        console.error("Erro ao configurar listener:", error);
        updateStatus(false);
      }
    }

    function renderCalendar() {
      const calendar = document.getElementById('calendar');
      const monthYear = document.getElementById('monthYear');
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      monthYear.textContent = `${months[month]} ${year}`;
      calendar.innerHTML = '';
      weekdays.forEach(day => {
        const div = document.createElement('div');
        div.className = 'weekday';
        div.textContent = day;
        calendar.appendChild(div);
      });
      const firstDay = new Date(year, month, 1);
      const startDate = new Date(firstDay);
      startDate.setDate(startDate.getDate() - firstDay.getDay());
      const today = getTodayDate();
      for (let i = 0; i < 42; i++) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + i);
        const dayEl = document.createElement('div');
        dayEl.className = 'day';
        const dayNum = document.createElement('div');
        dayNum.textContent = date.getDate();
        dayEl.appendChild(dayNum);
        if (date.getMonth() !== month) {
          dayEl.classList.add('other-month');
        }
        if (date.getTime() === today.getTime()) {
          dayEl.classList.add('today');
        }
        const dateStr = formatDateString(date);
        const dayEvents = events.filter(e => e.date === dateStr);
        if (dayEvents.length > 0) {
          dayEl.classList.add('has-event');
          const dots = document.createElement('div');
          dots.className = 'event-dots';
          dayEvents.forEach(() => {
            const dot = document.createElement('div');
            dot.className = 'dot';
            dots.appendChild(dot);
          });
          dayEl.appendChild(dots);
        }
        dayEl.addEventListener('click', () => {
          document.querySelectorAll('.day.selected').forEach(el => {
            el.classList.remove('selected');
          });
          dayEl.classList.add('selected');
          document.getElementById('eventDate').value = dateStr;
        });
        calendar.appendChild(dayEl);
      }
    }

    function renderEvents() {
      const list = document.getElementById('eventsList');
      if (events.length === 0) {
        list.innerHTML = '<div class="no-events">‚ú® Nenhum evento cadastrado</div>';
        return;
      }
      const today = getTodayDate();
      const sorted = [...events].sort((a, b) => {
        const dateA = createLocalDate(a.date);
        const dateB = createLocalDate(b.date);
        const aFuture = dateA >= today;
        const bFuture = dateB >= today;
        if (aFuture && !bFuture) return -1;
        if (!aFuture && bFuture) return 1;
        return aFuture ? dateA - dateB : dateB - dateA;
      });
      list.innerHTML = '';
      sorted.forEach((event, sortedIndex) => {
        const eventDate = createLocalDate(event.date);
        const isToday = eventDate.getTime() === today.getTime();
        const isPast = eventDate < today;
        const formattedDate = eventDate.toLocaleDateString('pt-BR', {
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });
        const diffDays = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));
        let statusText = '';
        let statusClass = '';
        if (isToday) {
          statusText = 'üî• HOJE';
          statusClass = 'status-today';
        } else if (diffDays === 1) {
          statusText = '‚ö° AMANH√É';
          statusClass = 'status-future';
        } else if (diffDays > 0) {
          statusText = `üìÖ Em ${diffDays} dias`;
          statusClass = 'status-future';
        } else {
          statusText = `üìú H√° ${Math.abs(diffDays)} dias`;
          statusClass = 'status-past';
        }
        const originalIndex = events.findIndex(e => e === event);
        const eventEl = document.createElement('div');
        eventEl.className = `event-item ${isToday ? 'event-today' : ''} ${isPast ? 'event-past' : ''}`;
        eventEl.innerHTML = `
          <div class="event-header">
            <div style="font-size: 14px; font-weight: 700; color: #4facfe; text-transform: uppercase;">${formattedDate}</div>
            <span class="event-status ${statusClass}">${statusText}</span>
          </div>
          <div style="font-size: 20px; font-weight: 700; color: #2d3748; margin-bottom: 10px;">${event.title}</div>
          ${event.time ? `<div style="font-size: 16px; color: #4a5568; margin-bottom: 10px;">‚è∞ ${event.time}</div>` : ''}
          ${event.description ? `<div style="font-size: 14px; color: #718096; line-height: 1.6;">${event.description}</div>` : ''}
          <button class="delete-btn" onclick="deleteEvent(${originalIndex})">√ó</button>
        `;
        list.appendChild(eventEl);
      });
    }

    async function addEvent(e) {
      e.preventDefault();
      const date = document.getElementById('eventDate').value;
      const title = document.getElementById('eventTitle').value;
      const time = document.getElementById('eventTime').value;
      const description = document.getElementById('eventDescription').value;
      if (!date || !title) {
        alert('Preencha pelo menos a data e o t√≠tulo!');
        return;
      }
      const eventData = {date, title, time, description};
      try {
        await saveEventToFirebase(eventData);
        document.getElementById('eventForm').reset();
        document.getElementById('eventDate').value = formatDateString(new Date());
        renderCalendar();
        renderEvents();
        const btn = document.querySelector('.btn-primary');
        const orig = btn.textContent;
        btn.textContent = '‚úÖ Salvo!';
        setTimeout(() => btn.textContent = orig, 2000);
      } catch (error) {
        alert('Erro ao salvar evento. Dados salvos localmente.');
      }
    }

    async function deleteEvent(index) {
      if (confirm('Excluir este evento?')) {
        const event = events[index];
        try {
          await deleteEventFromFirebase(event.id, index);
          renderCalendar();
          renderEvents();
        } catch (error) {
          alert('Erro ao excluir evento. Removido localmente.');
          renderCalendar();
          renderEvents();
        }
      }
    }

    function exportEvents() {
      const data = JSON.stringify(events, null, 2);
      const blob = new Blob([data], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `agenda_${formatDateString(new Date())}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function importEvents() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = async function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async function(e) {
          try {
            const loaded = JSON.parse(e.target.result);
            if (Array.isArray(loaded)) {
              showLoading('üì§ Importando eventos...');
              for (const event of loaded) {
                try {
                  await saveEventToFirebase(event);
                } catch (error) {
                  console.error('Erro ao importar evento:', error);
                }
              }
              alert(`‚úÖ ${loaded.length} eventos importados!`);
            } else {
              alert('‚ùå Formato inv√°lido!');
            }
          } catch (error) {
            alert('‚ùå Erro: ' + error.message);
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    async function syncData() {
      try {
        await loadEventsFromFirebase();
        showLoading('üîÑ Dados sincronizados!');
      } catch (error) {
        alert('Erro ao sincronizar dados');
      }
    }

    function prevMonth() {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    }

    function nextMonth() {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    }

    window.addEvent = addEvent;
    window.deleteEvent = deleteEvent;
    window.exportEvents = exportEvents;
    window.importEvents = importEvents;
    window.syncData = syncData;
    window.prevMonth = prevMonth;
    window.nextMonth = nextMonth;

    document.getElementById('eventForm').addEventListener('submit', addEvent);
    document.getElementById('eventDate').value = formatDateString(new Date());

    loadEventsFromFirebase().catch(() => {
      console.log('Firebase n√£o dispon√≠vel, usando localStorage');
      loadFromLocalStorage();
    });

    setupRealtimeListener();

    window.addEventListener('online', () => {
      updateStatus(true);
      syncData();
    });
    window.addEventListener('offline', () => updateStatus(false));
  </script>
</body>
</html>
